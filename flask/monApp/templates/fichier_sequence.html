{% extends "base.html" %}

{% block styles_additionnels %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_fichier_sequence.css') }}">
{% endblock %}

{% block main %}

<section class="block">
    <section class="titre">
        <h1>Campagne de Fouille : {{ campagne.nomCampagne }}</h1>
    </section>
    <section class="detail">
        <!-- Colonne de Gauche : Liste des Fichiers -->
        <article class="lstFichier">
            <div class="plus">
                <img src="{{ url_for('static', filename='img/plus.png') }}" alt="Ajouter un fichier" width="24" height="24"> 
            </div>
            
            {% for fichier in fichiers %}
            <!-- Le clic appelle la fonction JS et lui passe l'élément cliqué -->
            <div class="file-item" 
                 data-file-id="{{ fichier.idFichier }}" 
                 onclick="showFileInfo(this)">
                {{ fichier.nomFichier }}
            </div>
            <div class="trait_horizontal"></div>
            {% endfor %}
            {% if not fichiers %}
            <p style="padding: 10px; color: #888;">Aucun fichier séquencé disponible pour cette campagne.</p>
            {% endif %}
        </article>
        
        <!-- Colonne de Droite : Détails du Fichier (Pré-remplis par Flask/Jinja) -->
        <article class="detailFichier">
            <h4>Fichier Séquencé n°<span id="file-sequence-number">{{ initial_details.idFichier }}</span></h4>
            <h4>Échantillon n°<span id="file-sample-number">{{ initial_details.idEchantillon }}</span></h4>
            <div class="trait_horizontal"></div>
            
            <p>Espèce : <span id="file-species">{{ initial_details.espece }}</span></p>
            
            <div class="commentaire">
                <p>Commentaire : </p>
                <!-- L'attribut 'readonly' est ajouté pour empêcher la modification accidentelle -->
                <textarea name="commentaire" id="file-comment" placeholder="Ajouter un commentaire..." rows="5" readonly>{{ initial_details.commentaire }}</textarea>
            </div>
            
            <div class="televerser">
                <img src="{{ url_for('static', filename='img/televerser.png') }}" width="24" height="24">
                <button>Téléverser les séquences</button>
            </div>
        </article>
    </section>
</section>
<script>
    const ALL_FILE_DATA = {{ all_file_details | tojson | safe }};

    function showFileInfo(clickedElement) {
        // 1. Récupérer l'ID du fichier (clé dans notre dictionnaire)
        const fileId = clickedElement.getAttribute('data-file-id');
        
        // 2. Mettre en évidence l'élément cliqué (gère la classe 'active')
        document.querySelectorAll('.file-item').forEach(item => {
            item.classList.remove('active');
        });
        clickedElement.classList.add('active');
        
        // 3. Récupérer les données directement depuis l'objet global
        const data = ALL_FILE_DATA[fileId];

        if (data) {
            // 4. Mettre à jour les éléments HTML instantanément
            document.getElementById('file-sequence-number').textContent = data.idFichier || 'N/A';
            document.getElementById('file-sample-number').textContent = data.idEchantillon || 'N/A';
            document.getElementById('file-species').textContent = data.espece || 'Inconnue'; 
            // Mise à jour de la zone de commentaire (textarea)
            document.getElementById('file-comment').value = data.commentaire || '';
        } else {
            console.error(`Données manquantes pour l'ID de fichier: ${fileId}`);
            // Nettoyer l'affichage si les données sont introuvables
            document.getElementById('file-sequence-number').textContent = 'Erreur';
            document.getElementById('file-sample-number').textContent = 'Erreur';
            document.getElementById('file-species').textContent = 'Données non chargées';
            document.getElementById('file-comment').value = '';
        }
    }

    // 5. Initialisation : Mettre en évidence le premier fichier au chargement
    document.addEventListener('DOMContentLoaded', (event) => {
        // Sélectionner le premier élément de la liste
        const firstFile = document.querySelector('.file-item');
        if (firstFile) {
            // Appliquer le style 'active' pour montrer la sélection initiale
            firstFile.classList.add('active');
        }
    });

</script>
{% endblock %}