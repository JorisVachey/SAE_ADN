{% extends "base.html" %}

{% block styles_additionnels %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_ajout_supp.css') }}">
{% endblock %}

{% block main %}

<section style="margin-top: 0em;" class="block">
    <h1 style="font-size: 4em;">Campagne de Fouille n°{{ campagne.numCampagne }}</h1>
    <section class="detail_sequence">
        <article class="lstFichier">
            <div class="plus">
                <a href="{{ url_for('ajouter_echantillon', numCampagne=campagne.numCampagne) }}">
                    <img src="{{ url_for('static', filename='img/plus.png') }}" alt="Ajouter un fichier" width="24" height="24"> 
                </a>
            </div>
            {% for fichier in fichiers %}             
                <div class="file-item case" data-file-id="{{ fichier.idFichier }}" onclick="showFileInfo(this)">
                    {% set nb = random.randint(1,14) %}
                    <img class="fossile" src="{{ url_for('static', filename='img/fossiles/image' ~ nb ~ '.png') }}" alt="">
                    <p>{{ fichier.nomFichier }}</p>
                </div>
            {% endfor %}
            {% if not fichiers %}
                <p style="padding: 10px; color: #888;">Aucun fichier séquencé disponible pour cette campagne.</p>
            {% endif %}
        </article>
        <article class="detailFichier">
            <h1>Fichier Séquencé n°<span id="file-sequence-number">{{ initial_details.idFichier }}</span></h1>
            <h1>Échantillon n°<span id="file-sample-number">{{ initial_details.idEchantillon }}</span></h1>
            <div class="trait_horizontal"></div>
            <p style="font-size: 1.5em;">Espèce : <span id="file-species">{{ initial_details.espece }}</span></p>
            <div style="flex-direction: column;" class="commentaire">
                <p style="font-size: 1.5em;">Commentaire : </p>
                <textarea style="width: 95%;" name="commentaire" id="file-comment" placeholder="Ajouter un commentaire..." rows="5" >{{ initial_details.commentaire }}</textarea>
            </div>
        </article>
    </section>
</section>
<script>
    const ALL_FILE_DATA = JSON.parse('{{ all_file_details | tojson | safe }}');

    function showFileInfo(clickedElement) {
        const fileId = clickedElement.getAttribute('data-file-id');
        document.querySelectorAll('.file-item').forEach(item => {
            item.classList.remove('active');
        });
        clickedElement.classList.add('active');
        const data = ALL_FILE_DATA[fileId];
        if (data) {
            document.getElementById('file-sequence-number').textContent = data.idFichier || 'N/A';
            document.getElementById('file-sample-number').textContent = data.idEchantillon || 'N/A';
            document.getElementById('file-species').textContent = data.espece || 'Inconnue'; 
            document.getElementById('file-comment').value = data.commentaire || '';
        } else {
            console.error(`Données manquantes pour l'ID de fichier: ${fileId}`);
            document.getElementById('file-sequence-number').textContent = 'Erreur';
            document.getElementById('file-sample-number').textContent = 'Erreur';
            document.getElementById('file-species').textContent = 'Données non chargées';
            document.getElementById('file-comment').value = '';
        }
    }
    document.addEventListener('DOMContentLoaded', (event) => {
        const firstFile = document.querySelector('.file-item');
        if (firstFile) {
            firstFile.classList.add('active');
        }
    });
</script>

{% endblock %}