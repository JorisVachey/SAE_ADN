import adn as adn
import phylogenie as ph

LONGUEUR_BASE = 10
NOM_FICHIER_BASE = "test1"

print("Question 1\n")
adn.generer_adn(NOM_FICHIER_BASE + ".adn", LONGUEUR_BASE)
with open(NOM_FICHIER_BASE + ".adn", "r", encoding="utf8") as f:
    fichier = f.read()
print("Le fichier ADN", NOM_FICHIER_BASE + ".adn", "vaut", fichier)

print("\nQuestion2-3\n")
nom_fichier_mute, nb_mutations = adn.mutations(NOM_FICHIER_BASE  + ".adn", 0.2, 0.2, 0.2)
with open(nom_fichier_mute, "r", encoding="utf8") as f:
    fichier = f.read()
    longueur = len(fichier)
nouvelle_longueur_attendue = LONGUEUR_BASE + 0 - nb_mutations[1] + nb_mutations[2]
# Pour calculer la longueur attendue, on fait longueur de base, on ajoute 0 car les 
# mutations par remplacemment ne modifie pas la longueur, ensuite on enleve le nombre 
# de mutations supprimées puis on ajote le nombre de mutations inserées
print("La longueur attendu est de", nouvelle_longueur_attendue)
print("Le fichier ADN", nom_fichier_mute, "vaut", 
      fichier, "il est de longueur", longueur)
assert nouvelle_longueur_attendue == longueur, "La longueur attendu n'est pas la même que la longueur réelle"

print("\nQuestion4\n")
# Déclanche le except
try :
    distance = adn.distance_remplacement_chaine(NOM_FICHIER_BASE + ".adn", nom_fichier_mute)
except :
    print("Les fichiers", NOM_FICHIER_BASE + ".adn", "et", nom_fichier_mute, "ne font pas " \
    "la même longueur")
# Mutation seulemment par remplacemment
NOM_FICHIER_REMPLACEMMENT = "test1remplacemment"
adn.generer_adn(NOM_FICHIER_REMPLACEMMENT + ".adn", LONGUEUR_BASE)
with open(NOM_FICHIER_REMPLACEMMENT + ".adn", "r", encoding="utf8") as f:
    fichier = f.read()
nom_fichier_mute_remplacemment, nb_mutations = adn.mutations(NOM_FICHIER_REMPLACEMMENT  + ".adn", 0.4, 0, 0)
try : 
    distance2 = adn.distance_remplacement_chaine(NOM_FICHIER_REMPLACEMMENT + ".adn", nom_fichier_mute_remplacemment)
    with open(NOM_FICHIER_REMPLACEMMENT + ".adn", "r", encoding="utf8") as f:
        fichier = f.read()
    print("fichier base :", fichier)
    with open(nom_fichier_mute_remplacemment, "r", encoding="utf8") as f:
        fichier = f.read()
    print("fichier muté remplacemment :", fichier)
    print("La distance par remplacemment entre", NOM_FICHIER_REMPLACEMMENT + ".adn", "et", nom_fichier_mute, 
          "vaut", distance2)
except :
    print("Les fichiers", NOM_FICHIER_REMPLACEMMENT + ".adn", "et", nom_fichier_mute, "ne font pas " \
    "la même longueur")

print("\nQuestion6\n")
distance_levenshtein = adn.distance_levenshtein(NOM_FICHIER_REMPLACEMMENT + ".adn", nom_fichier_mute_remplacemment)
# La distance par remplacemment et la distance levenshtein doivent être égale, car les longueurs sont les même
try : 
    assert distance2 == distance_levenshtein
    print("La distance par remplacemment et levenshtein sont bien égaux")
except :
    "Erreur"

print("\nQuestion10-11\n")
adn.generer_adn("chameau.adn", 15)
with open("chameau.adn", "r", encoding="utf8") as f:
    fichier = f.read()
print("Le fichier ADN chameau.adn vaut", fichier)
chameau = ph.Espece("chameau")
assert chameau.nom == "chameau",  "le nom n'est pas le même"
try :
    chameau.get_filles()
except :
    pass

chameauAveree = ph.EspeceAveree("chameau.adn")
assert chameauAveree.nom == "chameau", "le nom n'est pas le même"
assert chameauAveree.get_adn() == fichier, "fichier ADN different"

espece1 = ph.Espece("lion")
espece2 = ph.Espece("tigre")
hypo = ph.EspeceHypothetique(espece1, espece2)
assert hypo.nom == "(lion+tigre)"
assert hypo.is_hypothetique() == True
assert len(hypo.filles) == 2

adn.generer_adn("a.adn", 10)
adn.generer_adn("b.adn", 10)
with open("a.adn", "r", encoding="utf8") as f:
    contenu_a = f.read()
with open("b.adn", "r", encoding="utf8") as f:
    contenu_b = f.read()
print("a.adn =", contenu_a)
print("b.adn =", contenu_b)
e1 = ph.EspeceAveree("a.adn")
e2 = ph.EspeceAveree("b.adn")
assert e1.nom == "a"
assert e2.nom == "b"
assert ph.distance_especes(e1, e2) == adn.distance_levenshtein(contenu_a, contenu_b)


print("\nQuestion12\n")
noms_especes = ["chien", "humain", "chat", "alligator", "souris"]
longueur_adn = 200
especes_averees = []

for nom in noms_especes:
    adn.generer_adn(nom, longueur_adn)
    nom_fichier_adn = nom + ".adn"
    espece_obj = ph.EspeceAveree(nom_fichier_adn)
    especes_averees.append(espece_obj)

print(len(especes_averees), "espèces créées")
if len(especes_averees) >= 2:
    racine = ph.reconstruire_arbre_phylogenetique(especes_averees)
    print(ph.visualiser_arbre(racine))   
else:
    print("Pas assez d'espèces (minimum 2) pour construire un arbre.")