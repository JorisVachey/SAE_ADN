import os
import fonctions_utiles as fu
from adn import *

class Espece:
    def __init__(self, nom):
        self.nom=nom
        self.filles=[]

    def is_hypothetique(self):
        return not self.filles==[]

    def get_filles(self):
        assert(self.is_hypothetique()), print("Votre espèce n'a pas de filles")
        return self.filles


class EspeceAveree(Espece):
    def __init__(self, nom_fichier):
        nom=os.path.basename(nom_fichier).replace('.adn', '')
        super().__init__(nom)
        try:
            self.adn_sequence = fu.transformer_fichier(nom_fichier)
            if not self.adn_sequence:
                raise ValueError("Le fichier ADN est vide.")
        except FileNotFoundError:
            print(f"ERREUR: Le fichier {nom_fichier} n'a pas été trouvé.")
            raise
        except Exception as e:
            print(f"ERREUR lors du chargement de {nom_fichier}: {e}")
            raise

    def get_adn(self):
        return self.adn_sequence
    
class EspeceHypothetique(Espece):
    def __init__(self, espece1, espece2):
        nom=f'({espece1.nom}+{espece2.nom})'
        super().__init__(nom)
        self.filles = [espece1, espece2]
    def get_adn(self):
        return None
    

def distance_especes(espece_a: Espece, espece_b: Espece)-> int: 
    if espece_a.is_hypothetique() and espece_b.is_hypothetique():
        fille1_a, fille2_a = espece_a.get_filles()
        d1=distance_especes(fille1_a, espece_b)
        d2=distance_especes(fille2_a, espece_b)
        return (d1+d2)/2
    
    elif espece_b.is_hypothetique():
        fille1_b, fille2_b=espece_b.get_filles()
        d1=distance_especes(espece_a, fille1_b)
        d2=distance_especes(espece_a, fille2_b)
        return (d1+d2)/2
    elif espece_a.is_hypothetique():
        fille1_a, fille2_a=espece_a.get_filles()
        d1=distance_especes(espece_b, fille1_a)
        d2=distance_especes(espece_b, fille2_a)
        return (d1+d2)/2
    
    else: 
        return distance_levenshtein(espece_a.get_adn(), espece_b.get_adn())
    

