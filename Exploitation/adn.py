import random
import os
nucleotides=['A','T','G','C']
def generer_adn(nom_fichier : str, longueur : int):
    chemin = os.path.join(os.getcwd(), f"{nom_fichier}.adn")
    nom_final=""
    res = ""
    if os.path.exists(chemin):
        rep = input("Le fichier existe déjà, voulez vous l'écraser ? (o/n): ")
        if rep.lower() == "o":
            for _ in range(longueur):
                res += random.choice(nucleotides)
            nom_final = nom_fichier
        else:
            while rep.lower() != "esc" and os.path.exists(chemin):
                rep = input("Veuillez entrer le nouveau nom de votre fichier ou 'esc' pour annuler: ")
                chemin = os.path.join(os.getcwd(), f"{rep}.adn")
                if not os.path.exists(chemin):
                    for _ in range(longueur):
                        res += random.choice(nucleotides)
                    nom_final = rep
                    break
                else:
                    print(f"Le fichier '{rep}.adn' existe déjà.")
    else:
        for _ in range(longueur):
            res += random.choice(nucleotides)
        nom_final = nom_fichier

    adn_formate = ""
    largeur_ligne = 80
    for i in range(0, len(res), largeur_ligne):
        adn_formate += res[i:i+largeur_ligne] + "\n"
    
    with open(f"{nom_final}.adn", "w", encoding="utf8") as f:
        f.write(adn_formate)
    print(f"Fichier '{nom_final}.adn' créé avec succès!")
    
def muter_adn(nom_fichier, proba_mutation):
    """
    Applique des mutations aléatoires à une séquence ADN avec probabilité p.
    
    Args:
        nom_fichier: fichier ADN d'entrée
        proba_mutation: probabilité de mutation pour chaque nucléotide (0.0 à 1.0)
        nom_fichier_sortie: fichier de sortie (optionnel)
    """
    import random
    if not nom_fichier.endswith('.adn'):
        nom_fichier += '.adn'
    nom_fichier_sortie = nom_fichier.replace('.adn', f'_mute_{int(proba_mutation*100)}.adn')
    sequence_mutee = ""
    mutations_count = 0
    with open(nom_fichier, 'r', encoding='utf8') as f:
        for ligne in f:
            ligne = ligne.strip()
            ligne_mutee = ""
            for nucleotide in ligne:
                if nucleotide in nucleotides:
                    if random.random() < proba_mutation:
                        nouveaux_nucleotides = [n for n in nucleotides if n != nucleotide]
                        nucleotide_mute = random.choice(nouveaux_nucleotides)
                        ligne_mutee += nucleotide_mute
                        mutations_count += 1
                    else:
                        ligne_mutee += nucleotide
                else:
                    ligne_mutee += nucleotide
            sequence_mutee += ligne_mutee + "\n"
    with open(nom_fichier_sortie, 'w', encoding='utf8') as f:
        f.write(sequence_mutee)
    
    print(f"Mutation terminée !")
    print(f"Fichier original: {nom_fichier}")
    print(f"Fichier muté: {nom_fichier_sortie}")
    print(f"Probabilité de mutation: {proba_mutation*100:.1f}%")
    print(f"Nombre de mutations appliquées: {mutations_count}")